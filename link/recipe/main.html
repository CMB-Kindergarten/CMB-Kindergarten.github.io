<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>每周食谱-聪明堡幼儿园</title>
    <link rel="shortcut icon" type="image/x-icon" href="../../logo.ico" />
    <link href="../../css/public.css"  rel="stylesheet" />
    <link href="../css/linkPublic.css"  rel="stylesheet" />
    <link href="css.css"  rel="stylesheet" />
    <script src="../../db/recipe.js" ></script>
    <script src="../../js/public.js" ></script>
    <script src="../../js/template.js" ></script>
</head>
<body>
<div id="center">
    <div id="top">
        <div class="banner">
            <div class="logo clear">
                <div class="img">
                    <a href="./../../index.html">
                        <img src="../../img/logo.png" alt="聪明堡幼儿园">
                    </a>
                </div>
                <h1 class="text">
                    <a href="./../../index.html"><span>聪明堡</span><span>幼</span><span>儿</span><span>园</span></a>
                </h1>
            </div>
        </div>
        <ul class="nav">
            <li><a href="./../../index.html">网站首页</a></li>
            <li><a href="../introduce.html">园所介绍</a></li>
            <li><a href="../activity/main.html">缤纷活动</a></li>
            <li><a href="../home/main.html">家园互动</a></li>
            <li><a href="./main.html">幼儿保健</a></li>
            <li><a href="../admission.html">招生简章</a></li>
            <li><a href="../message.html">留言板</a></li>
        </ul>
    </div>


    <div id="content">
        <div>
            <div class="title">
                <h2 class="content">每周食谱</h2>
            </div>
            <div class="text"></div>
            <script id="recipeText" type="text/html">
                <table>
                    <tr>
                        <th>标题</th>
                        <th>日期</th>
                    </tr>
                    <% if(now !== page){for(let i = (now-1)*len; i<(now-1)*len+len; i++){%>
                    <tr>
                        <td width="480"><a href="<%=recipe[i].url%>"><%=i+1%>.<%=recipe[i].title%></a></td>
                        <td width="200"><%=recipe[i].time%></td>
                    </tr>
                    <%}}else{for(let i=(now-1)*len; i<recipe.length; i++){%>
                    <tr>
                        <td width="480"><a href="<%=recipe[i].url%>"><%=i+1%>.<%=recipe[i].title%></a></td>
                        <td width="200"><%=recipe[i].time%></td>
                    </tr>
                    <%}}%>
                </table>
                <p class="now_all">第：<%=now%>/<%=page%>页</p>
            </script>
            <p class="page">
                <span>首页</span>
                <span>上一页</span>
                <span>下一页</span>
                <span>尾页</span>&nbsp;&nbsp;
                转到：<input type="text"/>&nbsp;
                <input type="button" value="GO"/>
            </p>
        </div>
    </div>

    <div id="footer">
        <div class="content clear">
            <div class="text">
                <p>哈尔滨聪明堡幼儿园</p>
                <p>电话：18946110350</p>
                <p>地址：哈尔滨市哈尔滨市哈尔滨市哈尔滨市</p>
                <p>家长信箱:123456789@abc.com</p>
                <p>技术支持：王卓然</p>
            </div>
            <img src="../../img/logo.png" />
        </div>
    </div>
</div>

<script>
    //把变量挂载到顶级window下，确保模板引擎和主页js都能获取
    window.now = 1;
    window.len = 15;
    window.page = Math.ceil(recipe.recipe.length/len);

    const changePage = document.querySelectorAll('.page span');
    const jump = document.querySelector('.page input[type="text"]');
    const GO = document.querySelector('.page input[type="button"]');

    render();
    judge();
    turnPagePrev();
    turnPageNext();

    GO.onclick = function(){
        if(!(jump.value>0 && jump.value<=page && parseInt(jump.value)===parseFloat(jump.value))){
            jump.value = '';
            alert('页码范围越界或格式有误');
            return;
        }
        now = parseInt(jump.value);
        render();
        judge();
        jump.value = '';
    };

    function turnPagePrev(){
        if(page === 1) return;      //若只有一页，则禁止翻页
        changePage[0].onclick = function(){
            now = 1;
            render();
            judge();
        };
        changePage[1].onclick = function(){
            now--;
            render();
            judge();
        };
    }
    function turnPageNext(){
        if(page === 1) return;
        changePage[2].onclick = function(){
            now++;
            render();
            judge();
        };
        changePage[3].onclick = function(){
            now = page;
            render();
            judge();
        };
    }
    function render(){      //渲染数据
        let templateText = document.querySelector('#recipeText').innerHTML;
        let wrap = document.querySelector('#content .text');
        wrap.innerHTML = template(templateText, recipe);
    }
    function judge(){       //判断是否为首页或尾页
        if(page === 1){
            changePage[0].className = changePage[1].className = 'disable';
            changePage[2].className = changePage[3].className = 'disable';
        }else if(now === 1){
            changePage[0].className = changePage[1].className = 'disable';
            changePage[2].className = changePage[3].className = '';
            changePage[0].onclick = changePage[1].onclick = null;
            turnPageNext();
        }else if(now === page){
            changePage[0].className = changePage[1].className = '';
            changePage[2].className = changePage[3].className = 'disable';
            changePage[2].onclick = changePage[3].onclick = null;
            turnPagePrev();
        }else{
            changePage[0].className = changePage[1].className = '';
            changePage[2].className = changePage[3].className = '';
            turnPagePrev();
            turnPageNext();
        }
    }
</script>
</body>
</html>